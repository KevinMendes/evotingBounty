# Config Cryptographic Parameters Tool

The Config Cryptographic Parameter Tool helps users with common cryptographic task related to the e-voting process.

The commands it provides are:

- `genEncryptionParameters` to generate the parameters of the ElGamal encryption scheme.
- `primeGroupMembers` to generate the small prime group members to encode voting options.
- `keystore` to generate a keystore and the related files for a voting components.

## genEncryptionParameters

This command should be run before the actual configuration phase and generates the ElGamal encryption parameters in a verifiable manner.

We refer the reader to the crypto-primitives and system specification for details on how we verifiably pick the ElGamal encryption parameters.

```shell
java -jar config-cryptographic-parameters-tool-{VERSION}.jar \
     -genEncryptionParameters \
     -seed_path seed.txt \
     -seed_sig_path seed.txt.p7 \
     -p12_path integration.p12 \
     -trusted_ca_path rootCA.pem \
     -out my_output/
```

Parameters help:

- `genEncryptionParameters` select the current command.
- `seed_path` is the path for the txt file containing the seed as a String.
- `seed_sig_path` is the path to the pkcs7 signature of the seed file.
- `p12_path` is the path to the Keystore containing the signing key.
- `trusted_ca_path` is the path to the trusted certificate for verifying the signature.
- `out` is the optional path where the tool persists the output files. Default value is `./output/`.

## primeGroupMembers

This command provides a list of prime numbers (which have to be members of the group) that can encode the voting options. This command need a set of
encryption parameters generated with the command `genEncryptionParameters`.

We refer the reader to the crypto-primitives and system specification for details on how we verifiably pick the voting options.

```shell
java -jar config-cryptographic-parameters-tool-{VERSION}.jar \
     -primeGroupMembers \
     -params_path encryptionParameters{TIMESTAMP}.json.sign \
     -p12_path integration.p12 \
     -trusted_ca_path rootCA.pem \
     -out my_output/
```

Parameters help:

- `primeGroupMembers` select the current command.
- `params_path` is the path to the file generated by `genEncryptionParameters`.
- `p12_path` is the path to the Keystore containing the signing key.
- `trusted_ca_path` is the path to the trusted certificate for verifying the signature.
- `out` is the optional path where the tool persists the output files. Default value is `./output/`.

## keystore

This command creates three files in the wanted directory (must be empty):

- A keystore.
  - which is protected by a main password.
  - which contains one new private key.
- A password file, which contains the password to unlock the keystore.
- A certificate related to the private key stored in the keystore.

```shell
java -jar config-cryptographic-parameters-tool-{VERSION}.jar \
     -keystore \
     -valid_from <dd/MM/yyyy> \
     -valid_until <dd/MM/yyyy> \
     -certificate_common_name <string> \
     -certificate_country <string> \
     -certificate_state <string> \
     -certificate_organisation <string> \
     -certificate_locality <string> \
     -alias <string> \
     -password_length <int> \
     -out <path> 
```

Parameters help:

- `keystore` select the current command.
- All the parameters below are related to the certificate:
  - `valid_from` date from which the certificate is valid.
  - `valid_until` date until which the certificate is valid.
  - `certificate_common_name` the name of the certificate.
  - `certificate_country` the country of the certificate.
  - `certificate_state` the state of the certificate.
  - `certificate_organisation` the organization of the certificate.
  - `certificate_locality` the locality of the certificate.
- `alias` is the alias name of the component we want to generate files for.
- `password_length` is the optional length of the generated password. Default length is `20`.
- `out` is the optional path where the tool will create the keystore, the password file and the certificate. Default value is `./output/`.

To see how to use this command for the certificates and keys management in e-voting, please follow the section below.

### Usage

The following e-voting components require a signing keystore.

- Setup Component
- Tally Control Component
- Voting Server
- Control Component 1
- Control Component 2
- Control Component 3
- Control Component 4

Each keystore contains the following :

- A private key to sign contents.
- All the trusted certificates of other components to validate the received content.

#### Alias

Each eVoting Component involved in signing is assigned an alias.

| Component name          | Alias               |
|-------------------------|---------------------|
| Setup Component         | SDM_CONFIG          |
| Tally Control Component | SDM_TALLY           |
| Voting Server           | VOTING_SERVER       |
| Control Component 1     | CONTROL_COMPONENT_1 |
| Control Component 2     | CONTROL_COMPONENT_2 |
| Control Component 3     | CONTROL_COMPONENT_3 |
| Control Component 4     | CONTROL_COMPONENT_4 |

#### Process

Follow the steps below to setup the evoting ecosystem:

##### 1. Generate files

As explained in the [README.md](README.md), you can generate the wanted keystore with this command:

```shell
java -jar config-cryptographic-parameters-tool-{VERSION}.jar \
     -keystore \
     -alias <Alias of the component> \
     -valid_from <dd/MM/yyyy> \
     -valid_until <dd/MM/yyyy> \
     -certificate_common_name <string> \
     -certificate_country <string> \
     -certificate_state <string> \
     -certificate_organisation <string> \
     -certificate_locality <string>
```

This will generate 3 files in the folder `./output/` named according to the alias you have entered.

##### 2. Certificates exchange

We assume the existence of an out-of-band channel that allows the protocol participants to exchange certificates and check their authenticity.

At the end of the process, the `./output/` folder contains all other parties' certificates.

##### 3. Certificates import

Switch to the `./output/` folder and import all the certificates received into the keystore using this command:

```shell
keytool -import \
        -alias <Alias of the component you are importing> \
        -file <Alias of the component you are importing>.crt \
		-keystore <Alias of the component you manage>.jks
```

Now run `keytool -list -keystore <Alias of the component you manage>.jks` and check you have all the entries listed.

## Development

```bash
mvn clean install
```
